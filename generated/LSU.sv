// Generated by CIRCT firtool-1.114.1
module LSU(
  input         clock,
  input  [31:0] io_in_alu_result,
                io_in_rs2_val,
  input  [4:0]  io_in_rd_addr,
  input         io_in_mem_wen,
                io_in_mem_ren,
  input  [2:0]  io_in_mem_op,
  input         io_in_reg_wen,
  output [31:0] io_out_wb_data,
  output [4:0]  io_out_rd_addr,
  output        io_out_reg_wen
);

  wire [31:0]      _dmem_read_rdata;
  wire             _GEN = io_in_mem_op == 3'h2;
  wire             _GEN_0 = io_in_mem_op == 3'h0;
  wire [3:0][7:0]  _GEN_1 =
    {{_dmem_read_rdata[31:24]},
     {_dmem_read_rdata[23:16]},
     {_dmem_read_rdata[15:8]},
     {_dmem_read_rdata[7:0]}};
  wire [7:0]       byte_data = _GEN_1[io_in_alu_result[1:0]];
  wire [3:0][7:0]  _GEN_2 =
    {{_dmem_read_rdata[31:24]},
     {_dmem_read_rdata[23:16]},
     {_dmem_read_rdata[15:8]},
     {_dmem_read_rdata[7:0]}};
  wire             _GEN_3 = io_in_mem_op == 3'h1;
  wire [15:0]      half_data =
    io_in_alu_result[1] ? _dmem_read_rdata[31:16] : _dmem_read_rdata[15:0];
  wire [7:0][31:0] _GEN_4 =
    {{32'h0},
     {32'h0},
     {{16'h0, io_in_alu_result[1] ? _dmem_read_rdata[31:16] : _dmem_read_rdata[15:0]}},
     {{24'h0, _GEN_2[io_in_alu_result[1:0]]}},
     {32'h0},
     {_dmem_read_rdata},
     {{{16{half_data[15]}}, half_data}},
     {{{24{byte_data[7]}}, byte_data}}};
  wire [3:0][31:0] _GEN_5 =
    {{{io_in_rs2_val[7:0], 24'h0}},
     {{8'h0, io_in_rs2_val[7:0], 16'h0}},
     {{16'h0, io_in_rs2_val[7:0], 8'h0}},
     {{24'h0, io_in_rs2_val[7:0]}}};
  PMEMRead dmem_read (
    .clock (clock),
    .raddr (io_in_alu_result),
    .rdata (_dmem_read_rdata)
  );
  PMEMWrite dmem_write (
    .clock (clock),
    .wen   (io_in_mem_wen),
    .waddr (io_in_alu_result),
    .wdata
      (_GEN
         ? io_in_rs2_val
         : _GEN_3
             ? (io_in_alu_result[1]
                  ? {io_in_rs2_val[15:0], 16'h0}
                  : {16'h0, io_in_rs2_val[15:0]})
             : _GEN_0 ? _GEN_5[io_in_alu_result[1:0]] : 32'h0),
    .wmask
      (_GEN
         ? 4'hF
         : _GEN_3
             ? (io_in_alu_result[1] ? 4'hC : 4'h3)
             : _GEN_0
                 ? ((&(io_in_alu_result[1:0]))
                      ? 4'h8
                      : {1'h0,
                         io_in_alu_result[1:0] == 2'h2
                           ? 3'h4
                           : {1'h0, io_in_alu_result[1:0] == 2'h1 ? 2'h2 : 2'h1}})
                 : 4'h0)
  );
  assign io_out_wb_data = io_in_mem_ren ? _GEN_4[io_in_mem_op] : io_in_alu_result;
  assign io_out_rd_addr = io_in_rd_addr;
  assign io_out_reg_wen = io_in_reg_wen;
endmodule

